__wxCodeSpace__.batchAddCompiledTemplate(function(G,R,D,Q,gdc,X,Y,Z,RG={}){var P=RG.P||function(a){return typeof a==='function'?a:()=>{}};return {'pages/driver/clockIn/clockIn':(()=>{var H={};var S;var I=(P)=>{if(!S)S=Object.assign({},H);return S[P]};H[""]=(R,C,D,U)=>{var L=R.c,M=R.m,O=R.r,A={"stationName":new Array(1)},K=U===true,f=(C,T)=>{C?T("上班"):T()},g,j=(C)=>{},k=(C,T)=>{C||K||!!U.start||undefined?T(Y(Y(D.start)+"已打卡")):T()},i=(C,T,E)=>{E("van-icon",{},(N,C)=>{if(C)O(N,"name","checked");if(C)O(N,"custom-class","clock-icon");if(C)O(N,"color","#169bd5")},j);E("text",{},(N,C)=>{if(C)L(N,"clock-text")},k)},m=(C,T)=>{C?T("未打卡"):T()},l=(C,T,E)=>{E("text",{},(N,C)=>{if(C)L(N,"clock-text")},m)},h=(C,T,E)=>{if(g===1){E("view",{},(N,C)=>{},i)}else{E("view",{},(N,C)=>{},l)}},e=(C,T,E,B)=>{E("view",{},(N,C)=>{},f);g=D.start?1:0;B(g,h)},d=(C,T,E)=>{E("view",{},(N,C)=>{if(C)L(N,"info-box-left")},e)},p=(C,T)=>{C?T("下班"):T()},q,t=(C)=>{},u=(C,T)=>{C||K||!!U.end||undefined?T(Y(Y(D.end)+"已打卡")):T()},s=(C,T,E)=>{E("van-icon",{},(N,C)=>{if(C)O(N,"name","checked");if(C)O(N,"custom-class","clock-icon");if(C)O(N,"color","#169bd5")},t);E("text",{},(N,C)=>{if(C)L(N,"clock-text")},u)},w=(C,T)=>{C?T("未打卡"):T()},v=(C,T,E)=>{E("text",{},(N,C)=>{if(C)L(N,"clock-text")},w)},r=(C,T,E)=>{if(q===1){E("view",{},(N,C)=>{},s)}else{E("view",{},(N,C)=>{},v)}},o=(C,T,E,B)=>{E("view",{},(N,C)=>{},p);q=D.end?1:0;B(q,r)},n=(C,T,E)=>{E("view",{},(N,C)=>{if(C)L(N,"info-box-right")},o)},c=(C,T,E)=>{E("van-col",{},(N,C)=>{if(C)O(N,"span","12")},d);E("van-col",{},(N,C)=>{if(C)O(N,"span","12")},n)},z,B0=(C,T)=>{C?T("上班打卡"):T()},A0=(C,T,E)=>{if(z===1){E("text",{},(N,C)=>{if(C)L(N,"clock-in-btn-text");if(C)O(N,"bindtap","clock");if(C)R.d(N,"type","in")},B0)}},C0,E0=(C,T)=>{C?T("下班打卡"):T()},D0=(C,T,E)=>{if(C0===1){E("text",{},(N,C)=>{if(C)L(N,"clock-in-btn-text");if(C)O(N,"bindtap","clock");if(C)R.d(N,"type","out")},E0)}},F0,H0=(C,T)=>{C?T("更新打卡"):T()},G0=(C,T,E)=>{if(F0===1){E("text",{},(N,C)=>{if(C)L(N,"clock-in-btn-text");if(C)O(N,"bindtap","clock")},H0)}},y=(C,T,E,B)=>{z=!D.start?1:0;B(z,A0);C0=D.start&&!D.end?1:0;B(C0,D0);F0=D.start&&D.end?1:0;B(F0,G0)},J0=(C)=>{},K0=(C,T)=>{C||K||!!U.stationName||undefined?T(Y("距当前位置最近站点："+Y(D.stationName)),(N)=>{A["stationName"][0]=(D,E,T)=>{T(N,Y("距当前位置最近站点："+Y(D.stationName)))}}):T()},I0=(C,T,E)=>{E("van-icon",{},(N,C)=>{if(C)O(N,"name","location");if(C)O(N,"custom-class","clock-icon");if(C)O(N,"color","#169bd5")},J0);E("text",{},(N,C)=>{if(C)L(N,"clock-text")},K0)},x=(C,T,E)=>{E("view",{},(N,C)=>{if(C)L(N,"clock-in-btn")},y);E("view",{},(N,C)=>{},I0)},b=(C,T,E)=>{E("van-row",{},(N,C)=>{if(C)L(N,"info-row")},c);E("van-row",{},(N,C)=>{if(C)L(N,"clock-in-row")},x)},L0=(C)=>{},M0=(C)=>{},a=(C,T,E)=>{E("view",{},(N,C)=>{if(C)L(N,"main")},b);E("van-dialog",{},(N,C)=>{if(C)R.i(N,"van-dialog")},L0);E("van-toast",{},(N,C)=>{if(C)R.i(N,"van-toast")},M0)};;return {C:a,B:A}};return Object.assign(function(R){return H[R]},{_:H})})(),}});;__wxRoute = "pages/driver/clockIn/clockIn";__wxRouteBegin = true;__wxAppCurrentFile__="pages/driver/clockIn/clockIn.js";define("pages/driver/clockIn/clockIn.js",function(require,module,exports,window,document,frames,self,location,navigator,localStorage,history,Caches,screen,alert,confirm,prompt,XMLHttpRequest,WebSocket,Reporter,webkit,WeixinJSCore){
"use strict";var t=require("../../../utils/client.js"),o=e(require("../../../component/vant-weapp/dist/dialog/dialog")),n=e(require("../../../component/vant-weapp/dist/toast/toast"));function e(t){return t&&t.__esModule?t:{default:t}}var a,c=getApp();Page({data:{station:"",stationName:"",start:"",end:"",clockInLock:!1},onLoad:function(t){this._getClockInfo(c.globalData.driver.id),this._checkLocationSet()},_checkLocationSet:function(){wx.getSetting({success:function(t){t.authSetting["scope.userLocation"]||wx.authorize({scope:"scope.userLocation",fail:function(t){o.default.alert({title:"获取位置失败",message:"请打开右上角菜单进入【设置】-【位置消息】，允许小程序获取您的位置信息"})},success:function(){}})}})},_getClockInfo:function(o){var n=this;(0,t.client)({method:"POST",data:{userId:o},url:"/driver/getClockInfo"}).then((function(t){if("6666"==t.meta.statusCode){var o=t.data.clockInfo;o&&n.setData({start:o.start?o.start:"",end:o.end?o.end:""})}}))},_lock:function(){this.setData({clockInLock:!0})},_unlock:function(){clearInterval(a),this.setData({clockInLock:!1})},_lockWhile:function(t){var o=this;o._lock(),t=t||15,a=setInterval((function(){o._unlock()}),1e3*t)},clock:function(o){var e=this;if(e.data.station){e.data.clockInLock?n.default.fail("15秒内不可连续打卡"):(e._lockWhile(15),(0,t.client)({method:"POST",data:{userId:c.globalData.driver.id,station:e.data.station,type:o.currentTarget.dataset.type},url:"/driver/clock"}).then((function(t){"6666"==t.meta.statusCode&&(n.default.success("打卡成功"),e._getClockInfo(c.globalData.driver.id))})))}else wx.showToast({title:"获取定位信息失败",icon:"error",duration:2e3})},onReady:function(){},onShow:function(){var t=this;c.getCurrStation().then((function(o){t.setData({station:o,stationName:c.globalData.stationMap[o]})}))},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){},onReachBottom:function(){},onShareAppMessage:function(){}});
},{isPage:true,isComponent:true,currentFile:'pages/driver/clockIn/clockIn.js'});require("pages/driver/clockIn/clockIn.js");