__wxCodeSpace__.batchAddCompiledTemplate(function(G,R,D,Q,gdc,X,Y,Z,RG={}){var P=RG.P||function(a){return typeof a==='function'?a:()=>{}};return {'pages/driver/scanCode/scanCode':(()=>{var H={};var S;var I=(P)=>{if(!S)S=Object.assign({},H);return S[P]};H[""]=(R,C,D,U)=>{var L=R.c,M=R.m,O=R.r,A={},K=U===true,b=(C)=>{},c=(C)=>{},d=(C)=>{},a=(C,T,E)=>{E("camera",{},(N,C)=>{if(C)R.y(N,"width:100%;height:100%;");if(C)O(N,"mode","scanCode");if(C)O(N,"bindscancode","scanCode")},b);E("van-toast",{},(N,C)=>{if(C)R.i(N,"van-toast")},c);E("van-dialog",{},(N,C)=>{if(C)R.i(N,"van-dialog")},d)};;return {C:a,B:A}};return Object.assign(function(R){return H[R]},{_:H})})(),}});;__wxRoute = "pages/driver/scanCode/scanCode";__wxRouteBegin = true;__wxAppCurrentFile__="pages/driver/scanCode/scanCode.js";define("pages/driver/scanCode/scanCode.js",function(require,module,exports,window,document,frames,self,location,navigator,localStorage,history,Caches,screen,alert,confirm,prompt,XMLHttpRequest,WebSocket,Reporter,webkit,WeixinJSCore){
"use strict";var t=require("../../../utils/client.js"),e=s(require("../../../component/vant-weapp/dist/toast/toast")),a=s(require("../../../component/vant-weapp/dist/dialog/dialog"));function s(t){return t&&t.__esModule?t:{default:t}}var n=getApp(),o=require("../../../utils/aesed.js");Page({data:{taskId:"",busNumber:"",scanFunctionIsUseAble:!0},onLoad:function(t){this.setData({taskId:t.taskId,busNumber:t.busNumber,dep:t.dep,arr:t.arr}),wx.getSetting({success:function(t){t.authSetting["scope.camera"]||wx.authorize({scope:"scope.camera",fail:function(t){a.default.alert({title:"获取相机权限失败",message:"请打开右上角菜单进入【设置】，允许小程序使用摄像头"})},success:function(){}})}})},scanCode:function(t){var e=this;if(e.data.scanFunctionIsUseAble){e.setData({scanFunctionIsUseAble:!1}),setTimeout((function(){e.setData({scanFunctionIsUseAble:!0})}),2e3);var a=o.Decrypt(t.detail.result,"lxaprssbussystem"),s=JSON.parse(a);e._checkTicket(s)}},_checkTicket:function(a){if(a.start&&a.start==this.data.dep)if(a.to&&a.to==this.data.arr){var s={orderId:a.orderId,passNum:a.num,taskId:this.data.taskId,busNumber:this.data.busNumber,userId:n.globalData.driver.id};(0,t.client)({method:"POST",data:s,url:"/driver/checkTicket"}).then((function(t){"6666"==t.meta.statusCode&&t.meta.success?e.default.success("验票成功！"):e.default.fail(t.data.msg)}))}else e.default.fail("目的站与本次班车不符");else e.default.fail("始发站与本次班车不符")},onReady:function(){wx.setNavigationBarColor({backgroundColor:"#000000",frontColor:"#ffffff"})},onShow:function(){},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){},onReachBottom:function(){},onShareAppMessage:function(){}});
},{isPage:true,isComponent:true,currentFile:'pages/driver/scanCode/scanCode.js'});require("pages/driver/scanCode/scanCode.js");