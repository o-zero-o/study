__wxCodeSpace__.batchAddCompiledTemplate(function(G,R,D,Q,gdc,X,Y,Z,RG={}){var P=RG.P||function(a){return typeof a==='function'?a:()=>{}};return {'pages/driver/list/list':(()=>{var H={};var S;var I=(P)=>{if(!S)S=Object.assign({},H);return S[P]};H[""]=(R,C,D,U)=>{var L=R.c,M=R.m,O=R.r,A={"busOrder":new Array(1),"depart":new Array(1),"name":new Array(1),"taskCount":new Array(1),"arrival":new Array(1),"posNameList":new Array(1)},K=U===true,f=(C,T)=>{C?T("驾驶员"):T()},g=(C,T)=>{C||K||U.name?T(Y(D.name),(N)=>{A["name"][0]=(D,E,T)=>{T(N,Y(D.name))}}):T()},e=(C,T,E)=>{E("text",{},(N,C)=>{if(C)L(N,"prop-title")},f);E("text",{},(N,C)=>{if(C)L(N,"prop-text")},g)},i=(C,T)=>{C?T("驾驶车辆"):T()},j=(C,T)=>{C||K||U.busNumber?T(Y(D.busNumber)):T()},h=(C,T,E)=>{E("text",{},(N,C)=>{if(C)L(N,"prop-title")},i);E("text",{},(N,C)=>{if(C)L(N,"prop-text")},j)},l=(C,T)=>{C?T("今日跑单次数"):T()},m=(C,T)=>{C||K||U.taskCount?T(Y(D.taskCount),(N)=>{A["taskCount"][0]=(D,E,T)=>{T(N,Y(D.taskCount))}}):T()},k=(C,T,E)=>{E("text",{},(N,C)=>{if(C)L(N,"prop-title")},l);E("text",{},(N,C)=>{if(C)L(N,"prop-text")},m)},d=(C,T,E)=>{E("van-col",{},(N,C)=>{if(C)O(N,"span","8");if(C)O(N,"custom-class","driver-prop")},e);E("van-col",{},(N,C)=>{if(C)O(N,"span","8");if(C)O(N,"custom-class","driver-prop center-prop")},h);E("van-col",{},(N,C)=>{if(C)O(N,"span","8");if(C)O(N,"custom-class","driver-prop")},k)},c=(C,T,E)=>{E("van-row",{},(N,C)=>{},d)},r=(C,T)=>{C?T("当前任务"):T()},s=(C)=>{},q=(C,T,E)=>{E("text",{},(N,C)=>{if(C)L(N,"curr-task-title")},r);E("van-icon",{},(N,C)=>{if(C)O(N,"name","logistics");if(C)O(N,"size","18");if(C)O(N,"color","#ffff00");if(C)O(N,"custom-class","logistics")},s)},u=(C,T)=>{C||K||!!(U.depart||U.arrival)||undefined?T(Y(Y(D.depart)+"至"+Y(D.arrival)),(N)=>{A["depart"][0]=A["arrival"][0]=(D,E,T)=>{T(N,Y(Y(D.depart)+"至"+Y(D.arrival)))}}):T()},t=(C,T,E)=>{E("text",{},(N,C)=>{if(C)L(N,"route")},u)},p=(C,T,E)=>{E("van-col",{},(N,C)=>{if(C)O(N,"span","6");if(C)O(N,"custom-class","task-title")},q);E("van-col",{},(N,C)=>{if(C)O(N,"span","18");if(C)O(N,"custom-class","task-text")},t)},x=(C,T)=>{C?T("发车排序"):T()},y=(C,T)=>{C||K||U.busOrder?T(Y(D.busOrder),(N)=>{A["busOrder"][0]=(D,E,T)=>{T(N,Y(D.busOrder))}}):T()},w=(C,T,E)=>{E("text",{},(N,C)=>{if(C)L(N,"prop-title")},x);E("text",{},(N,C)=>{if(C)L(N,"prop-text")},y)},A0,C0=(C,T)=>{C?T("预计到达时间"):T()},D0=(C,T)=>{C?T("预计发车时间"):T()},B0=(C,T,E)=>{if(A0===1){E("text",{},(N,C)=>{if(C)L(N,"prop-title")},C0)}else{E("text",{},(N,C)=>{if(C)L(N,"prop-title")},D0)}},E0,G0=(C,T)=>{C||K||U.eta?T(Y(D.eta)):T()},H0=(C,T)=>{C||K||U.etd?T(Y(D.etd)):T()},F0=(C,T,E)=>{if(E0===1){E("text",{},(N,C)=>{if(C)L(N,"prop-text")},G0)}else{E("text",{},(N,C)=>{if(C)L(N,"prop-text")},H0)}},z=(C,T,E,B)=>{A0=D.status=="4"?1:0;B(A0,B0);E0=D.status=="4"?1:0;B(E0,F0)},J0=(C,T)=>{C?T("登车人数"):T()},K0=(C,T)=>{C||K||U.passNum?T(Y(D.passNum)):T()},I0=(C,T,E)=>{E("text",{},(N,C)=>{if(C)L(N,"prop-title")},J0);E("text",{},(N,C)=>{if(C)L(N,"prop-text")},K0)},v=(C,T,E)=>{E("van-col",{},(N,C)=>{if(C)O(N,"span","8");if(C)O(N,"custom-class","task-prop")},w);E("van-col",{},(N,C)=>{if(C)O(N,"span","8");if(C)O(N,"custom-class","task-prop center-prop")},z);E("van-col",{},(N,C)=>{if(C)O(N,"span","8");if(C)O(N,"custom-class","task-prop")},I0)},N0,P0=(C,T)=>{C?T("申请发车"):T()},O0=(C,T,E)=>{if(N0===1){E("van-button",{},(N,C)=>{if(C)O(N,"custom-class","oper-btn");if(C)O(N,"round",true);if(C)O(N,"block",true);if(C)O(N,"size","small");if(C)R.d(N,"status","2");if(C)R.v(N,"click","changeTaskStatus",!1,!1,!1,!1)},P0)}},Q0,S0=(C,T)=>{C?T("申请发车中"):T()},R0=(C,T,E)=>{if(Q0===1){E("van-button",{},(N,C)=>{if(C)O(N,"custom-class","oper-btn");if(C)O(N,"round",true);if(C)O(N,"block",true);if(C)O(N,"disabled",true);if(C)O(N,"size","small")},S0)}},T0,V0=(C,T)=>{C?T("申请取消"):T()},U0=(C,T,E)=>{if(T0===1){E("van-button",{},(N,C)=>{if(C)O(N,"custom-class","oper-btn");if(C)O(N,"round",true);if(C)O(N,"block",true);if(C)O(N,"size","small");if(C)R.d(N,"status","1");if(C)R.v(N,"click","changeTaskStatus",!1,!1,!1,!1)},V0)}},M0=(C,T,E,B)=>{N0=D.status=="1"?1:0;B(N0,O0);Q0=D.status=="2"?1:0;B(Q0,R0);T0=D.status=="3"&&D.passNum==0?1:0;B(T0,U0)},X0,Z0=(C,T)=>{C?T("旅客送达"):T()},Y0=(C,T,E)=>{if(X0===1){E("van-button",{},(N,C)=>{if(C)O(N,"custom-class","oper-btn");if(C)O(N,"round",true);if(C)O(N,"block",true);if(C)O(N,"size","small");if(C)R.d(N,"status","5");if(C)R.v(N,"click","changeTaskStatus",!1,!1,!1,!1)},Z0)}},a0,c0=(C,T)=>{C?T("旅客送达"):T()},b0=(C,T,E)=>{if(a0===1){E("van-button",{},(N,C)=>{if(C)O(N,"custom-class","oper-btn");if(C)O(N,"round",true);if(C)O(N,"block",true);if(C)O(N,"disabled",true);if(C)O(N,"size","small")},c0)}},W0=(C,T,E,B)=>{X0=D.status=="3"?1:0;B(X0,Y0);a0=D.taskId!=""&&D.status&&D.status!="3"?1:0;B(a0,b0)},L0=(C,T,E)=>{E("van-col",{},(N,C)=>{if(C)O(N,"span","12")},M0);E("van-col",{},(N,C)=>{if(C)O(N,"span","12")},W0)},o=(C,T,E)=>{E("van-row",{},(N,C)=>{},p);E("van-row",{},(N,C)=>{if(C)O(N,"custom-class","task-row")},v);E("van-row",{},(N,C)=>{},L0)},n=(C,T,E)=>{E("view",{},(N,C)=>{if(C)L(N,"task-box")},o)},e0,g0=(C,T)=>{C?T("验票"):T()},f0=(C,T,E)=>{if(e0===1){E("van-button",{},(N,C)=>{if(C)O(N,"custom-class","check-ticket");if(C)O(N,"block",true);if(C)O(N,"color","linear-gradient(to right , #1fbbfd ,#169bd5)");if(C)R.v(N,"click","checkTicket",!1,!1,!1,!1)},g0)}},h0,j0=(C,T)=>{C?T("恢复验票"):T()},i0=(C,T,E)=>{if(h0===1){E("van-button",{},(N,C)=>{if(C)O(N,"custom-class","check-ticket");if(C)O(N,"block",true);if(C)O(N,"color","linear-gradient(to right , #1fbbfd ,#169bd5)");if(C)R.v(N,"click","recoverTicket",!1,!1,!1,!1)},j0)}},d0=(C,T,E,B)=>{e0=D.taskId!=""?1:0;B(e0,f0);h0=D.taskId!=""?1:0;B(h0,i0)},l0,n0=(C)=>{},m0=(C,T,E)=>{if(l0===1){E("van-cell",{},(N,C)=>{if(C)O(N,"custom-class","driver-cell");if(C)O(N,"title","申领任务");if(C)O(N,"icon","exchange")},n0)}},k0=(C,T,E,B)=>{l0=D.taskId==""&&D.busNumber!="-"?1:0;B(l0,m0)},o0,q0=(C)=>{},p0=(C,T,E)=>{if(o0===1){E("van-cell",{},(N,C)=>{if(C)O(N,"custom-class","driver-cell");if(C)O(N,"title","取消任务");if(C)O(N,"icon","failure");if(C)R.v(N,"click","cancelTask",!1,!1,!1,!1)},q0)}},r0=(C)=>{},s0=(C)=>{},t0=(C)=>{},b=(C,T,E,B)=>{E("view",{},(N,C)=>{if(C)L(N,"driver-info")},c);E("view",{},(N,C)=>{if(C)L(N,"task-info")},n);E("view",{},(N,C)=>{if(C)L(N,"operate")},d0);E("picker",{},(N,C)=>{if(C)L(N,"to-place-picker");if(C)O(N,"bindchange","applyTask");if(C||K||U.posNameList)O(N,"range",D.posNameList);A["posNameList"][0]=(D,E,T)=>{O(N,"range",D.posNameList);E(N)}},k0);o0=D.taskId!=""&&D.passNum==0?1:0;B(o0,p0);E("van-cell",{},(N,C)=>{if(C)O(N,"custom-class","driver-cell");if(C)O(N,"title","车辆绑定");if(C)O(N,"icon","logistics");if(C)O(N,"is-link",true);if(C)O(N,"link-type","navigateTo");if(C||K||!!U.taskId||undefined)O(N,"url","/pages/driver/binding/binding?taskId="+Y(D.taskId))},r0);E("van-cell",{},(N,C)=>{if(C)O(N,"custom-class","driver-cell");if(C)O(N,"title","异常事件报送");if(C)O(N,"icon","warn-o");if(C)O(N,"is-link",true);if(C)O(N,"link-type","navigateTo");if(C||K||!!U.taskId||undefined)O(N,"url","/pages/driver/errorSubmit/errorSubmit?taskId="+Y(D.taskId))},s0);E("van-cell",{},(N,C)=>{if(C)O(N,"custom-class","logout-cell");if(C)O(N,"title","退出登录");if(C)O(N,"icon","revoke");if(C)R.v(N,"click","logout",!1,!1,!1,!1)},t0)},u0=(C)=>{},v0=(C)=>{},a=(C,T,E)=>{E("view",{},(N,C)=>{if(C)L(N,"info-box")},b);E("van-toast",{},(N,C)=>{if(C)R.i(N,"van-toast")},u0);E("van-dialog",{},(N,C)=>{if(C)R.i(N,"van-dialog")},v0)};;return {C:a,B:A}};return Object.assign(function(R){return H[R]},{_:H})})(),}});;__wxRoute = "pages/driver/list/list";__wxRouteBegin = true;__wxAppCurrentFile__="pages/driver/list/list.js";define("pages/driver/list/list.js",function(require,module,exports,window,document,frames,self,location,navigator,localStorage,history,Caches,screen,alert,confirm,prompt,XMLHttpRequest,WebSocket,Reporter,webkit,WeixinJSCore){
"use strict";var t=require("../../../utils/client.js"),a=s(require("../../../component/vant-weapp/dist/toast/toast")),e=s(require("../../../component/vant-weapp/dist/dialog/dialog"));function s(t){return t&&t.__esModule?t:{default:t}}var r=getApp(),d=null;Page({data:{driverId:"",taskId:""},onLoad:function(t){if(t.id){var a=r.globalData.driver.pos?r.globalData.driver.pos.id:"";this.setData({driverId:t.id,driverPosId:a}),this._getTaskInfo(t.id)}this._getPosInfo(r.globalData.driver.id)},_getPosInfo:function(a){var e=this;(0,t.client)({method:"POST",data:{userId:a},url:"/driver/getPosInfo"}).then((function(t){if("6666"==t.meta.statusCode){for(var a=t.data.posInfo,s=[],r=0;r<a.posList.length;r++)s.push(a.posList[r].name);e.setData({posList:a.posList,posNameList:s})}}))},_getTaskInfo:function(a){var e=this;(0,t.client)({method:"POST",data:{id:a},url:"/driver/getTaskInfo",silence:!0}).then((function(t){if("6666"==t.meta.statusCode){var a=t.data.taskInfo;e.setData({name:a.name?a.name:"-",busNumber:a.busNumber?a.busNumber:"-",taskCount:a.taskCount?a.taskCount:0,taskId:a.taskId?a.taskId:"",dep:a.dep?a.dep:"",depart:a.dep?r.globalData.stationMap[a.dep]:"-",arr:a.arr?a.arr:"",arrival:a.arr?r.globalData.stationMap[a.arr]:"-",etd:a.etd?a.etd.substr(11):"-",eta:a.eta?a.eta.substr(11):"-",busOrder:a.busOrder?a.busOrder:"-",passNum:a.passNum?a.passNum:0,status:a.status?a.status:""})}}))},changeTaskStatus:function(t){var a=this,s=this,r=t.currentTarget.dataset.status,d="";"2"==r?d="当前登车人数"+s.data.passNum+"，是否确认发车？":"1"==r?d="是否确认申请取消发车？":"5"==r&&(d="是否确认旅客已送达？"),d?e.default.confirm({message:d}).then((function(){if(s.changeStatus(r),"5"==r){a.setData({taskId:"",dep:"",depart:"-",arr:"",arrival:"-",etd:"-",eta:"-",busOrder:"-",passNum:0,status:""})}})).catch((function(){})):s.changeStatus(r)},changeStatus:function(a){var e=this;(0,t.client)({method:"POST",data:{taskId:this.data.taskId,status:a,station:this.data.arr,userId:r.globalData.driver.id},url:"/driver/changeTaskStatus"}).then((function(t){"6666"==t.meta.statusCode&&e.setData({status:a})}))},scanCode:function(t){},checkTicket:function(){this.data.taskId&&wx.navigateTo({url:"../scanCode/scanCode?taskId="+this.data.taskId+"&busNumber="+this.data.busNumber+"&dep="+this.data.dep+"&arr="+this.data.arr})},recoverTicket:function(){this.data.taskId&&wx.navigateTo({url:"../recoverCode/recoverCode?taskId="+this.data.taskId+"&busNumber="+this.data.busNumber+"&dep="+this.data.dep+"&arr="+this.data.arr})},applyTask:function(e){var s=this;wx.showLoading({title:"申请中",mask:!0}),(0,t.client)({method:"POST",data:{userId:r.globalData.driver.id,station:s.data.posList[e.detail.value].id},url:"/driver/applyTask",silence:!0}).then((function(t){wx.hideLoading(),"6666"==t.meta.statusCode?s._getTaskInfo(r.globalData.driver.id):a.default.fail(t.meta.msg)}))},cancelTask:function(){var a=this;e.default.confirm({title:"取消任务",message:"是否确认取消任务？"}).then((function(){(0,t.client)({method:"POST",data:{userId:r.globalData.driver.id},url:"/driver/cancelTask"}).then((function(t){if("6666"==t.meta.statusCode){a.setData({taskId:"",dep:"",depart:"-",arr:"",arrival:"-",etd:"-",eta:"-",busOrder:"-",passNum:0,status:""})}}))})).catch((function(){}))},logout:function(){e.default.confirm({title:"退出登录",message:"是否确认退出登录？"}).then((function(){(0,t.client)({method:"POST",data:{userId:r.globalData.driver.id},url:"/driver/logout"}).then((function(t){"6666"==t.meta.statusCode&&(wx.setStorageSync("userName",""),r.globalData.driver=null,wx.switchTab({url:"/pages/driver/driver"}))}))})).catch((function(){}))},onReady:function(){},onShow:function(){var t=this;clearInterval(d),t._getTaskInfo(t.data.driverId),d=setInterval((function(){t._getTaskInfo(t.data.driverId)}),1e4);var a=r.globalData.driver.pos?r.globalData.driver.pos.id:"";this.setData({driverPosId:a})},onHide:function(){clearInterval(d)},onUnload:function(){clearInterval(d)},onPullDownRefresh:function(){},onReachBottom:function(){},onShareAppMessage:function(){}});
},{isPage:true,isComponent:true,currentFile:'pages/driver/list/list.js'});require("pages/driver/list/list.js");